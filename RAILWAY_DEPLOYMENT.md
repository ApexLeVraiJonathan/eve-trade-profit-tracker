# 🚂 Railway Deployment Guide

Complete guide for deploying EVE Trade Profit Tracker to Railway.

## 🎯 **Railway Configuration Files Created**

### ✅ `railway.json`

- Configures build and deployment settings
- Uses pnpm for package management
- Sets up health check endpoints
- Configures restart policies

### ✅ `package.json` Updates

- **Build script**: `prisma generate && nest build` (no DB connection)
- **Start script**: `prisma migrate deploy && node dist/main` (with DB connection)
- **Railway script**: `railway:start` for production deployment

## 🔧 **Railway Setup Steps**

### **1. Connect Repository**

1. Go to [Railway.app](https://railway.app)
2. Click "New Project" → "Deploy from GitHub repo"
3. Select your EVE Trade Profit Tracker repository
4. Railway will automatically detect it's a Node.js project

### **2. Add PostgreSQL Database**

1. In your Railway project dashboard
2. Click "New" → "Database" → "Add PostgreSQL"
3. Railway will automatically create `DATABASE_URL` environment variable

### **3. Configure Environment Variables**

In Railway dashboard, go to your service → Variables tab:

```bash
# 🔥 REQUIRED VARIABLES
DATABASE_URL=postgresql://...  # Auto-generated by Railway PostgreSQL
NODE_ENV=production

# 🌐 ESI Configuration
ESI_USER_AGENT=EVE-Trade-Profit-Tracker/1.0.0 your-email@example.com +https://github.com/your/repo
ESI_CONTACT_EMAIL=your-email@example.com
ESI_MAX_REQUESTS_PER_SECOND=50

# ⚙️ Application Settings
PORT=3000
LOG_LEVEL=log
ENABLE_SCHEDULER=true

# 🚀 Production Optimizations
NPM_CONFIG_PRODUCTION=false  # Needed for Prisma generation
```

### **4. Deploy & Monitor**

1. Push your code to GitHub
2. Railway automatically builds and deploys
3. Monitor deployment in Railway dashboard
4. Check logs for any issues

## 🚀 **Post-Deployment Setup**

### **1. Database Seeding**

After successful deployment, seed your database:

```bash
# Get your Railway app URL from dashboard
export RAILWAY_URL="https://your-app.railway.app"

# 1. Seed reference data (regions, stations, item types)
curl -X POST "$RAILWAY_URL/reference-data/update-all"

# 2. Update item volumes from ESI
curl -X POST "$RAILWAY_URL/reference-data/update-volumes"

# 3. Initialize default trade hub stations
curl -X POST "$RAILWAY_URL/tracked-stations/initialize-defaults"

# 4. Enable daily data collection
curl -X PUT "$RAILWAY_URL/scheduler/enable"

# 5. Test manual data fetch
curl -X POST "$RAILWAY_URL/daily-data/fetch"
```

### **2. Verify Deployment**

Check these endpoints:

```bash
# Health check
GET https://your-app.railway.app/health

# API documentation
GET https://your-app.railway.app/api

# ESI service status
GET https://your-app.railway.app/esi/status

# Scheduler status
GET https://your-app.railway.app/scheduler/status

# Reference data stats
GET https://your-app.railway.app/reference-data/stats
```

## 🔍 **Troubleshooting**

### **Build Issues**

- **Problem**: Build fails with database connection error
- **Solution**: Check that `prisma generate` runs during build, not `prisma migrate`

### **Startup Issues**

- **Problem**: App fails to start
- **Solution**: Check Railway logs for database connection or migration issues

### **Database Issues**

- **Problem**: Prisma migrations fail
- **Solution**: Ensure `DATABASE_URL` is correctly set and PostgreSQL service is running

### **Scheduler Issues**

- **Problem**: Daily data collection not working
- **Solution**: Verify `ENABLE_SCHEDULER=true` and check `/scheduler/status`

## 🛠️ **Railway-Specific Features**

### **Automatic HTTPS**

Railway provides automatic HTTPS for all deployments.

### **Custom Domain** (Optional)

1. Go to Settings → Domains in Railway dashboard
2. Add your custom domain
3. Update DNS records as instructed

### **Environment Promotion**

Railway supports multiple environments (staging, production):

1. Create new environment in dashboard
2. Deploy same codebase with different variables
3. Test before promoting to production

### **Monitoring & Logs**

- **Real-time logs**: Available in Railway dashboard
- **Metrics**: CPU, memory, network usage
- **Health checks**: Automatic monitoring of `/health` endpoint

## 🎯 **Production Checklist**

- ✅ Railway project created and connected
- ✅ PostgreSQL database added
- ✅ Environment variables configured
- ✅ App deployed successfully
- ✅ Health check endpoints responding
- ✅ Database seeded with reference data
- ✅ Trade hub stations initialized
- ✅ Daily scheduler enabled
- ✅ API documentation accessible
- ✅ All endpoints tested

## 🔒 **Security Notes**

### **Environment Variables**

- Never commit real environment variables to git
- Use Railway's secure variable storage
- Rotate API keys periodically

### **Database Security**

- Railway PostgreSQL is automatically secured
- Database URL includes authentication
- No additional firewall configuration needed

### **API Security**

- All traffic automatically uses HTTPS
- Consider adding rate limiting for public APIs
- Monitor logs for suspicious activity

## 🚀 **Production Performance**

### **Railway Resource Limits**

- **Free Tier**: 512MB RAM, 1 vCPU
- **Pro Tier**: Up to 8GB RAM, 8 vCPU
- **Auto-scaling**: Based on traffic

### **Database Performance**

- Railway PostgreSQL includes connection pooling
- Monitor database performance in dashboard
- Consider upgrading if you hit limits

### **Caching Strategy**

- ESI responses are cached internally
- Reference data is static (updated daily)
- Consider Redis for additional caching if needed

---

## 🎉 **You're Production Ready!**

Your EVE Trade Profit Tracker is now:

- ✅ **Deployed to Railway** with automatic HTTPS
- ✅ **Database integrated** with PostgreSQL
- ✅ **Scheduled data collection** running daily
- ✅ **Health monitoring** with built-in checks
- ✅ **API documentation** available at `/api`
- ✅ **Production logging** and error tracking

Happy trading! 🚀📈
